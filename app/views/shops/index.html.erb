<script type="text/javascript">
<% content_for :extra_js do %>
  (function() {
    var $form = $('#filters_form');
    var $input = $('#f_order');
    var current_order = $input.val() == '' ? false : $input.val();
    $('[data-order]').click(function(e) {
      var $this = $(this);
      var order = $this.data('order');
      var new_order, match;
      if (current_order && (match = current_order.match(new RegExp(order + '_(asc|desc)')))) {
        var current_dir = match[1];
        var dir = current_dir == 'asc' ? 'desc' : 'asc';
        new_order = order + '_' + dir;
      } else {
        new_order = order + '_asc';
      };
      $input.val(new_order);
      $form.submit();
    });
  })();
<% end %>
</script>

  

<div class="row">
  <div class="col-lg-12">
    <h1 class="page-header">
      Puestos
      <%= link_to 'Agregar puesto', new_shop_path, class: 'btn btn-primary pull-right' %>
    </h1>
    <div class="filters-table">
      <form id="filters_form" method="get">
        <input type="hidden" name="f[order]" id="f_order" value="<%= params[:f][:order].to_s rescue nil %>">
        <div class="form-group">
          <div class="col-xs-6 mb-10">
            <input type="search" class="form-control" id="f_search" name="f[search]" placeholder="Descripción o Nº de puesto" value="<%= params[:f][:search] rescue nil %>">
          </div>
          <div class="col-xs-3 mb-10">
            <select id="f_scopes_category" class="form-control" name="f[scopes][category]">
              <option value="">Categoría</option>
              <% @categories.each do |c| %>
                <option value="<%= c.id %>" <%= 'selected="selected"' if params[:f][:scopes][:category] == c.id.to_s rescue nil %>><%= c.title %></option>
              <% end %>
            </select>
          </div>
          <div class="col-xs-3 mb-10">
            <select id="f_scopes_shed" class="form-control" name="f[scopes][shed]">
              <option value="">Galpón</option>
              <% @sheds.each do |s| %>
                <option value="<%= s.id %>" <%= 'selected="selected"' if params[:f][:scopes][:shed] == s.id.to_s rescue nil %>><%= s.title %></option>
              <% end %>
            </select>
          </div>
          <div class="col-xs-6">
            <select id="f_scopes_user" class="form-control" name="f[scopes][user]">
              <option value="">Usuario</option>
              <% @users.each do |u| %>
                <option value="<%= u.id %>" <%= 'selected="selected"' if params[:f][:scopes][:user] == u.id.to_s rescue nil %>><%= u.name %></option>
              <% end %>
            </select>
          </div>
          <div class="col-xs-3">
            <a href="<%= shops_path %>" class="btn btn-default btn-block">Limpiar filtros</a>
          </div>
          <div class="col-xs-3">
            <button type="submit" class="btn btn-primary btn-block">Buscar</button>
          </div>
        </div>
      </form>
    </div>
    <% if @shops.blank? %>
      <h5 class="blank-search">No se encontraron puestos que coincidan con tu búsqueda</h5>
    <% else %>
      <table class="table table-striped table-controls" width="100%">
        <thead>
          <tr>
            <th>
              <a href="#" data-order="number_id">
                Nº Puesto
                <% if (params[:f][:order].to_sym == :number_id_asc rescue false) %>
                  <i class="fa fa-chevron-down" aria-hidden="true"></i>
                <% elsif (params[:f][:order].to_sym == :number_id_desc rescue false) %>
                  <i class="fa fa-chevron-up" aria-hidden="true"></i>
                <% end %>
              </a>
            </th>
            <th>
              <a href="#" data-order="user">
                Usuario
                <% if (params[:f][:order].to_sym == :user_asc rescue false) %>
                  <i class="fa fa-chevron-down" aria-hidden="true"></i>
                <% elsif (params[:f][:order].to_sym == :user_desc rescue false) %>
                  <i class="fa fa-chevron-up" aria-hidden="true"></i>
                <% end %>
              </a>
            </th>
            <th>
              <a href="#" data-order="shed">
                Galpón
                <% if (params[:f][:order].to_sym == :shed_asc rescue false) %>
                  <i class="fa fa-chevron-down" aria-hidden="true"></i>
                <% elsif (params[:f][:order].to_sym == :shed_desc rescue false) %>
                  <i class="fa fa-chevron-up" aria-hidden="true"></i>
                <% end %>
              </a>
            </th>
            <th>
              <a href="#" data-order="description">
                Descripción
                <% if (params[:f][:order].to_sym == :description_asc rescue false) %>
                  <i class="fa fa-chevron-down" aria-hidden="true"></i>
                <% elsif (params[:f][:order].to_sym == :description_desc rescue false) %>
                  <i class="fa fa-chevron-up" aria-hidden="true"></i>
                <% end %>
              </a>
            </th>
            <th></th>
          </tr>
        </thead>

        <tbody>
          <% @shops.each do |shop| %>
            <tr>
              <td><%= shop.number_id %></td>
              <td><%= shop.user_name %></td>
              <td><%= shop.shed_title %></td>
              <td><%= shop.description %></td>
              <td>
                <div class="btn-group btn-group-xs" role="group" aria-label="...">
                  <%= link_to '<i class="fa fa-eye" aria-hidden="true"></i>'.html_safe, shop, class: 'btn btn-default' %>
                  <%= link_to '<i class="fa fa-pencil" aria-hidden="true"></i>'.html_safe, edit_shop_path(shop), class: 'btn btn-info' %>
                  <%= link_to '<i class="fa fa-trash" aria-hidden="true"></i>'.html_safe, shop, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger' %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>
    <div class="pagination-table">
      <%= paginate @shops %>
    </div>
  </div>
</div>